---
import PostsList from '@components/common/posts/List.astro'
import type { Post, PostList } from '@types'
import DEVTO_RESPONSE from '@/data/devto.response.json'

const isDev = import.meta.env.DEV;
let posts: PostList = [];

if (isDev) {
    posts = DEVTO_RESPONSE;
} else {
    const response = await fetch('https://www.dev.to/api/articles/me?page=1&per_page=20', {
        headers: {
            'api-key': import.meta.env.DEVTO_APIKEY
        },
    });
    const data: PostList = await response.json();

    posts = data.sort((a: Post, b: Post) => {
        return b.page_views_count - a.page_views_count
    }).slice(0, 5);
}

---
<div class="w-full">
    <div class="flex justify-between">
        <h5 class="text-xl text-white font-semibold mb-6">Most popular posts</h5>
        <a href="/posts" class="text-rose-800 font-bold">All posts â†’</a>
    </div>
    
    <div class="w-full">
        <PostsList posts={posts} />
    </div>

    <div class="w-full mt-5 text-right">
        
    </div>
</div>